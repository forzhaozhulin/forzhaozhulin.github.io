---
layout: post
title:  "HTTP协议"
date:   2017-12-19
categories: web
tags: http
---

* content
{:toc}
# HTTP协议

`协议`：是通信双方应该遵守的一个共同的规则。

两台计算机（两个人）按照指定的规则，让互联网中的计算机可以`相互收发数据`的这个规则，就是`HTTP协议`。

<!-- more -->

超文本传输协议（HTTP，HyperText Transfer Protocol)是互联网上应用最为广泛的一种网络协议。

所有的WWW文件都必须遵守这个标准。

### http的相关概念：

1. 域名代替IP，默认端口是80（如果端口号是80，可以省略不写）
2. http协议永远是客户端（浏览器或者手机等）发送请求，服务器回送响应
3. http协议是基于TCP协议。

### HTTP协议的主要特点：

1. 支持客户/服务器模式。
2. 简单快速：客户向服务器请求服务时，只需传送请求方法和路径。请求方法常用的有GET、HEAD、POST。每种方法规定了客户与服务器联系的类型不同。由于HTTP协议简单，使得HTTP服务器的程序规模小，因而通信速度很快。
3. 灵活：HTTP允许传输任意类型的数据对象。正在传输的类型由Content-Type加以标记。
4. 无连接：无连接的含义是限制每次连接只处理一个请求。服务器处理完客户的请求，并收到客户的应答后，即断开连接。采用这种方式可以节省传输时间。
5. 无状态：HTTP协议是无状态协议。无状态是指协议对于事务处理没有记忆能力。缺少状态意味着如果后续处理需要前面的信息，则它必须重传，这样可能导致每次连接传送的数据量增大。另一方面，在服务器不需要先前信息时它的应答就较快。

### HTTP请求方法：

根据HTTP标准，HTTP请求可以使用多种请求方法。

HTTP1.0定义了三种请求方法： `GET`, `POST` 和 HEAD方法。

HTTP1.1新增了五种请求方法：OPTIONS, PUT, DELETE, TRACE 和 CONNECT 方法。

| **序号** | **方法**  | **描述**                                   |
| ------ | ------- | ---------------------------------------- |
| 1      | GET     | 请求指定的页面信息，并返回实体主体。                       |
| 2      | HEAD    | 类似于get请求，只不过返回的响应中没有具体的内容，用于获取报头         |
| 3      | POST    | 向指定资源提交数据进行处理请求（例如提交表单或者上传文件）。数据被包含在请求体中。POST请求可能会导致新的资源的建立和/或已有资源的修改。 |
| 4      | PUT     | 从客户端向服务器传送的数据取代指定的文档的内容。                 |
| 5      | DELETE  | 请求服务器删除指定的页面。                            |
| 6      | CONNECT | HTTP/1.1协议中预留给能够将连接改为管道方式的代理服务器。         |
| 7      | OPTIONS | 允许客户端查看服务器的性能。                           |
| 8      | TRACE   | 回显服务器收到的请求，主要用于测试或诊断。                    |

一般常用GET和POST。

####GET和POST的区别:

Get请求：暴露请求参数在地址栏不安全

POST：不会暴露参数

Get请求方式数据有长度限制，所有浏览器，都不允许，在地址无限的书写内容

Post请求方式，长度没有限制，可用户文件上传这样的功能。



### http规定：请求的数据必须分成三部分：

1. 请求行
2. 请求头
3. 请求体

####  请求行：分成3部分：

请求行：GET /test/2.html HTTP/1.1

GET： 请求方式

/test/1.html?name=tom ：请求地址 ？后面是请求参数（用户名密码等等。。。）

HTTP/1.1：HTTP版本

#### 请求头：

它是有key和value组成的数据，key和value之间必须使用冒号隔开。一个key可以对应多个value值。

​    Host    localhost:8080  服务器的域名
​    User-Agent      Mozilla/5.0 (Windows NT 10.0; …) Gecko/20100101 Firefox/55.0  

​         首部包含了一个特征字符串，用来让网络协议的对端来识别发起请求的用户代理软件的应用类型、操作系统、软件开发商以及版本号。

​    Accept    text/html,application/xhtml+xm…plication/xml;q=0.9,*/*;q=0.8  客户端可以处理的内容类型（text/html，超文本）
​    Accept-Language    zh-CN,zh;q=0.8,en-US;q=0.5,en;q=0.3  使用的语言
​    Accept-Encoding    gzip, deflate  压缩格式
​    Referer    http://127.0.0.1:8080/test/1.html?name=tom  当前页面的来源页面的地址
​    Content-Type    application/x-www-form-urlencoded  发送前对所有字符进行编码
​    Content-Length    12  数据长度
​    Connection    keep-alive 保持网络连接
​    Upgrade-Insecure-Requests    1客户端优先选择加密及带有身份验证的响应

请求体：post请求，会将请求要发送的参数，设置到请求体中                 

get请求没有请求体，请求参数在请求行中

### http协议中在定义响应格式：分成3部分：

1. 响应行
2. 响应头
3. 响应体

#### 响应行：HTTP/1.1 200 OK

​    http/1.1 表示http协议和版本

​    200 响应状态码  

​    OK 状态码代表意义 ，请求成功，响应完成

### 状态码

状态码有三位数字组成，第一个数字定义了响应的类别，且有五种可能取值：
1xx：指示信息--表示请求已接收，继续处理
2xx：成功--表示请求已被成功接收、理解、接受
3xx：重定向--要完成请求必须进行更进一步的操作
4xx：客户端错误--请求有语法错误或请求无法实现
5xx：服务器端错误--服务器未能实现合法的请求

#### 常见状态代码、状态描述、说明：

200 OK      //客户端请求成功
400 Bad Request  //客户端请求有语法错误，不能被服务器所理解
401 Unauthorized //请求未经授权，这个状态代码必须和WWW-Authenticate报头域一起使用 
403 Forbidden  //服务器收到请求，但是拒绝提供服务
404 Not Found  //请求资源不存在，eg：输入了错误的URL
500 Internal Server Error //服务器发生不可预期的错误
503 Server Unavailable  //服务器当前不能处理客户端的请求，一段时间后可能恢复正常
eg：HTTP/1.1 200 OK （CRLF）

常见的**响应头**信息参数说明：

​    Location: http://www.it315.org/index.jsp  //  通常告知浏览器 马上向该地址发送请求 通常 和 302 一起使用!!
​        （重点） 结合302完成重定向 操作 Location重定向后地址
​    Server:apache tomcat 服务器类型
​    Content-Encoding: gzip  响应编码类型 gzip压缩
​    Content-Length: 800  响应体的长度
​    Content-Language: zh-cn 响应语言
​    Content-Type: text/html; charset=GB2312 响应字符集  决定浏览器打开文件格式类型 以及编码
​    Last-Modified: Tue, 11 Jul 2000 18:23:51 GMT 和If-Modified-Since 一起使用，实现服务器缓存策略
​    Refresh: 3;url=http://www.jd.com （页面自动刷新）

​	3 表示是的时间，3秒;url表示地址;到3秒后，页面刷新url。



### 响应体——页面要展示的内容



### HTTP协议相关技术补充

1. 基础：

    高层协议有：文件传输协议FTP、电子邮件传输协议SMTP、域名系统服务DNS、网络新闻传输协议NNTP和HTTP协议等中介由三种：代理(Proxy)、网关(Gateway)和通道(Tunnel)，一个代理根据URI的绝对格式来接受请求，重写全部或部分消息，通过 URI的标识把已格式化过的请求发送到服务器。网关是一个接收代理，作为一些其它服务器的上层，并且如果必须的话，可以把请求翻译给下层的服务器协议。一 个通道作为不改变消息的两个连接之间的中继点。当通讯需要通过一个中介(例如：防火墙等)或者是中介不能识别消息的内容时，通道经常被使用。

   代理(Proxy)：一个中间程序，它可以充当一个服务器，也可以充当一个客户机，为其它客户机建立请求。请求是通过可能的翻译在内部或经过传递到其它的 服务器中。一个代理在发送请求信息之前，必须解释并且如果可能重写它。代理经常作为通过防火墙的客户机端的门户，代理还可以作为一个帮助应用来通过协议处 理没有被用户代理完成的请求。

   网关(Gateway)：一个作为其它服务器中间媒介的服务器。与代理不同的是，网关接受请求就好象对被请求的资源来说它就是源服务器；发出请求的客户机并没有意识到它在同网关打交道。

   网关经常作为通过防火墙的服务器端的门户，网关还可以作为一个协议翻译器以便存取那些存储在非HTTP系统中的资源。

   通道(Tunnel)：是作为两个连接中继的中介程序。一旦激活，通道便被认为不属于HTTP通讯，尽管通道可能是被一个HTTP请求初始化的。当被中继 的连接两端关闭时，通道便消失。当一个门户(Portal)必须存在或中介(Intermediary)不能解释中继的通讯时通道被经常使用。


2. 协议分析的优势—HTTP分析器检测网络攻击

   以模块化的方式对高层协议进行分析处理，将是未来入侵检测的方向。

   HTTP及其代理的常用端口80、3128和8080在network部分用port标签进行了规定


3. HTTP协议Content Lenth限制漏洞导致拒绝服务攻击

   使用POST方法时，可以设置ContentLenth来定义需要传送的数据长度，例如ContentLenth:999999999，在传送完成前，内 存不会释放，攻击者可以利用这个缺陷，连续向WEB服务器发送垃圾数据直至WEB服务器内存耗尽。这种攻击方法基本不会留下痕迹。

   http://www.cnpaf.net/Class/HTTP/0532918532667330.html


4. 利用HTTP协议的特性进行拒绝服务攻击的一些构思

   服务器端忙于处理攻击者伪造的TCP连接请求而无暇理睬客户的正常请求（毕竟客户端的正常请求比率非常之小），此时从正常客户的角度看来，服务器失去响应，这种情况我们称作：服务器端受到了SYNFlood攻击（SYN洪水攻击）。而Smurf、TearDrop等是利用ICMP报文来Flood和IP碎片攻击的。本文用“正常连接”的方法来产生拒绝服务攻击。19端口在早期已经有人用来做Chargen攻击了，即Chargen_Denial_of_Service，但是！他们用的方法是在两台Chargen 服务器之间产生UDP连接，让服务器处理过多信息而DOWN掉，那么，干掉一台WEB服务器的条件就必须有2个：1.有Chargen服务2.有HTTP 服务方法：攻击者伪造源IP给N台Chargen发送连接请求（Connect），Chargen接收到连接后就会返回每秒72字节的字符流（实际上根据网络实际情况，这个速度更快）给服务器。


5. Http指纹识别技术

   Http指纹识别的原理大致上也是相同的：记录不同服务器对Http协议执行中的微小差别进行识别.Htt指纹识别比TCP/IP堆栈指纹识别复杂许 多,理由是定制Http服务器的配置文件、增加插件或组件使得更改Http的响应信息变的很容易,这样使得识别变的困难；然而定制TCP/IP堆栈的行为 需要对核心层进行修改,所以就容易识别.要让服务器返回不同的Banner信息的设置是很简单的,象Apache这样的开放源代码的Http服务器,用户可以在源代码里修改Banner信息,然 后重起Http服务就生效了；对于没有公开源代码的Http服务器比如微软的IIS或者是Netscape,可以在存放Banner信息的Dll文件中修 改,相关的文章有讨论的,这里不再赘述,当然这样的修改的效果还是不错的.另外一种模糊Banner信息的方法是使用插件。

   常用测试请求：

   1：HEAD/Http/1.0发送基本的Http请求

   2：DELETE/Http/1.0发送那些不被允许的请求,比如Delete请求

   3：GET/Http/3.0发送一个非法版本的Http协议请求

   4：GET/JUNK/1.0发送一个不正确规格的Http协议请求

   Http指纹识别工具Httprint,它通过运用统计学原理,组合模糊的逻辑学技术,能很有效的确定Http服务器的类型.它可以被用来收集和分析不同Http服务器产生的签名。


6. 其他：为了提高用户使用浏览器时的性能，现代浏览器还支持并发的访问方式，浏览一个网页时同时建立多个连接，以迅速获得一个网页上的多个图标，这样能更快速完成整个网页的传输。HTTP1.1中提供了这种持续连接的方式，而下一代HTTP协议：HTTP-NG更增加了有关会话控制、丰富的内容协商等方式的支持，来提供更高效率的连接。

参考：[HTTP协议详解（真的很经典）](http://www.cnblogs.com/li0803/archive/2008/11/03/1324746.html)